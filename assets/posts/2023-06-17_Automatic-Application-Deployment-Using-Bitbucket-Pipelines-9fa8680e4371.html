<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Automatic Application Deployment Using Bitbucket Pipelines</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Automatic Application Deployment Using Bitbucket Pipelines</h1>
</header>
<section data-field="subtitle" class="p-summary">
If you want to automate your routine working days this article is for you. You can find my experience using Bitbucket pipelines for Angular…
</section>
<section data-field="body" class="e-content">
<section name="f475" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="4ed4" id="4ed4" class="graf graf--h3 graf--leading graf--title">Automatic Application Deployment Using Bitbucket Pipelines</h3><figure name="d314" id="d314" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*DodMO9jDtkg3pYO5y1H_ZQ.png" data-width="1920" data-height="1080" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*DodMO9jDtkg3pYO5y1H_ZQ.png"></figure><p name="13e4" id="13e4" class="graf graf--p graf-after--figure">If you want to automate your routine working days this article is for you. You can find my experience using Bitbucket pipelines for Angular applications and Node.js servers there. But you can use these instructions for any project and any language. So let&#39;s go deeper.</p><h4 name="da89" id="da89" class="graf graf--h4 graf-after--p">What are Bitbucket pipelines?</h4><p name="7fbe" id="7fbe" class="graf graf--p graf-after--h4">Bitbucket Pipelines is a continuous integration and delivery (CI/CD) platform provided by Atlassian. It is tightly integrated with the Bitbucket Cloud repository hosting service and allows developers to automate various tasks, such as building, testing, and deploying their applications.</p><p name="80ac" id="80ac" class="graf graf--p graf-after--p">In simple terms, Bitbucket Pipelines provides a way to define a series of steps or actions that are executed whenever changes are made to a repository. These steps are defined in a configuration file called “bitbucket-pipelines.yml” which resides in the root of the repository.</p><p name="a054" id="a054" class="graf graf--p graf-after--p">Bitbucket Pipelines uses Docker images, which means your builds are consistent and reliable. You won’t have to worry about weird environment issues anymore. Just specify the Node.js version you want, add your dependencies, and let it do its magic.</p><p name="c361" id="c361" class="graf graf--p graf-after--p">Here is an example of “bitbucket-pipelines.yml”:</p><figure name="1fa6" id="1fa6" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/TeslenkoOleg/7b295bb8b6bd3e3c2ac7156edba65d72.js"></script></figure><h4 name="b977" id="b977" class="graf graf--h4 graf-after--figure">Angular CI/CD</h4><p name="f348" id="f348" class="graf graf--p graf-after--h4">First of all, you need to have a repository with your Angular application on Bitbucket. In your repository, you can find the “Pipelines” tab in the sidebar. On the “Pipelines” page you would be able to create the first “bitbucket-pipelines.yml” template.</p><figure name="23dc" id="23dc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*xiyhiBuDZLMHi-0qslu5tA.png" data-width="2930" data-height="1184" alt="pipelines page" src="https://cdn-images-1.medium.com/max/800/1*xiyhiBuDZLMHi-0qslu5tA.png"><figcaption class="imageCaption">The pipelines page</figcaption></figure><p name="0917" id="0917" class="graf graf--p graf-after--figure">Now you need to add the next code to your template:</p><figure name="996a" id="996a" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/TeslenkoOleg/6d0bb2495be8c6b1e0148bdf8f2f9c99.js"></script></figure><p name="9b3e" id="9b3e" class="graf graf--p graf-after--figure">Here’s a breakdown of each line in the provided Bitbucket Pipelines configuration:</p><ol class="postList"><li name="603e" id="603e" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">image: node:14.20</code>Specifies the Docker image to be used for the pipeline. In this case, it uses the <code class="markup--code markup--li-code">node:14.20</code> image, which is based on Node.js version 14.20.</li><li name="72e4" id="72e4" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">pipelines:</code> (Start of the pipelines block). Begins the definition of pipelines.</li><li name="5432" id="5432" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">branches:</code> (Start of the branches block). Specifies that the following steps should only run for branches.</li><li name="bd09" id="bd09" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">test:</code> (Start of the test branch block). Specifies that the following steps should run for the branch named “test”.</li><li name="6859" id="6859" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">- step:</code> (Start of the first step block). Defines a new step within the pipeline.</li><li name="d9cd" id="d9cd" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">name: Install</code>Sets the name of the step as “Install”. This is just a label for the step.</li><li name="4400" id="4400" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">caches: </code>Specifies the caches to be used in the step.</li><li name="9408" id="9408" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">- node </code>Specifies that the “node” cache should be used. Caching allows reusing dependencies between pipeline runs for faster execution.</li><li name="14ee" id="14ee" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">script: </code>Indicates the start of the script section where the actual commands for the step are defined.</li><li name="6ab6" id="6ab6" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">- apt-get update </code>Updates the package repository on the built environment.</li><li name="fb55" id="fb55" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">- npm i -f </code>Forces the installation of Node.js dependencies using npm.</li><li name="ce7e" id="ce7e" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">- npm run build:test </code>Runs the build:test script defined in the project’s package.json file.</li><li name="913c" id="913c" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">artifacts:</code>Specifies the artifacts that should be saved from this step to be used in subsequent steps.</li><li name="8137" id="8137" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">- dist/**</code>Saves the “dist” folder and its contents as an artifact. The double asterisk notation (<code class="markup--code markup--li-code">**</code>) represents any subdirectories within &quot;dist&quot; as well.</li><li name="8b74" id="8b74" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">- step:</code> (Start of the second step block). Defines a new step within the pipeline.</li><li name="7ad7" id="7ad7" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">name: Deploy</code>Sets the name of the step as “Deploy”.</li><li name="acc3" id="acc3" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">script:</code>Indicates the start of the script section for the “Deploy” step.</li><li name="2f25" id="2f25" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">- cp .htaccess dist/</code>Copies the “.htaccess” file to the “dist” folder. This is an additional step, not directly related to the deployment process.</li><li name="4198" id="4198" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">- scp -r -P 22 dist/ user@111.22.33.10:/home/user/</code>Uses Secure Copy (SCP) to copy the “dist” folder and its contents to the remote server at the specified address and directory.</li><li name="6a45" id="6a45" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">- ssh user@111.22.33.10 -p 22 &#39;cd /var/www/ &amp;&amp; rm -rf dist_old &amp;&amp; mv dist dist_old &amp;&amp; cp -r /home/user/dist/ dist&#39; </code>Connects to the remote server via SSH and executes a series of commands: it changes the working directory to “/var/www/”, removes the existing “dist_old” folder, renames the current “dist” folder to “dist_old”, and finally copies the “dist” folder from the user’s home directory to the current working directory.</li></ol><p name="b45e" id="b45e" class="graf graf--p graf-after--li">After saving this pipeline to your project you need to give access for connection to your server because Bitbucket could not connect via SSH without keys.</p><p name="424d" id="424d" class="graf graf--p graf-after--p">First of all, you have to generate or add your own keys on the “SSH Keys” page in the “Pipeline section” (“Repository settings” tab). Pipelines use an SSH key pair and known host information to securely connect to other services and hosts. Read more about <a href="https://support.atlassian.com/bitbucket-cloud/docs/using-ssh-keys-in-bitbucket-pipelines/" data-href="https://support.atlassian.com/bitbucket-cloud/docs/using-ssh-keys-in-bitbucket-pipelines/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">SSH keys in Pipelines</a>.</p><figure name="ceda" id="ceda" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*coz4-wStdYWKlEk1UNIYYw.png" data-width="2866" data-height="1402" src="https://cdn-images-1.medium.com/max/800/1*coz4-wStdYWKlEk1UNIYYw.png"></figure><p name="be3c" id="be3c" class="graf graf--p graf-after--figure">After that, you could be able to copy your public key to <strong class="markup--strong markup--p-strong">~/.ssh/authorized_keys</strong> on the remote host.</p><figure name="7fef" id="7fef" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*rrkeU601WVK8Fx8sT0LfEw.png" data-width="1964" data-height="1660" src="https://cdn-images-1.medium.com/max/800/1*rrkeU601WVK8Fx8sT0LfEw.png"></figure><p name="6957" id="6957" class="graf graf--p graf-after--figure">The next step is to add a host address <em class="markup--em markup--p-em">with a port (if it needed)</em>, then click <strong class="markup--strong markup--p-strong">Fetch</strong> to see the host’s fingerprint. Read about <a href="https://support.atlassian.com/bitbucket-cloud/docs/set-up-pipelines-ssh-keys-on-linux/#Update-the-known-hosts" data-href="https://support.atlassian.com/bitbucket-cloud/docs/set-up-pipelines-ssh-keys-on-linux/#Update-the-known-hosts" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">known hosts for Pipelines</a>.</p><figure name="4abb" id="4abb" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5O5E7y-lp7XMYu0H_fzZLg.png" data-width="1982" data-height="1648" src="https://cdn-images-1.medium.com/max/800/1*5O5E7y-lp7XMYu0H_fzZLg.png"></figure><blockquote name="79a2" id="79a2" class="graf graf--blockquote graf-after--figure">All these steps are required for each repository where you want to use pipelines.</blockquote><p name="ac14" id="ac14" class="graf graf--p graf-after--blockquote">Although your SSH connection is set, here is one more thing you should do — check the owner of your directory at the remote host <em class="markup--em markup--p-em">(your directory owner should be the same as that in the pipeline).</em></p><p name="c897" id="c897" class="graf graf--p graf-after--p">Finally, you can push or merge your test branch to see the magic of automatization on the “Pipelines” page. You also will receive email notifications about failed actions in your pipelines.</p><figure name="e3ff" id="e3ff" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*1F7leZ0-sTNGow8CKvroxQ.png" data-width="3396" data-height="868" src="https://cdn-images-1.medium.com/max/800/1*1F7leZ0-sTNGow8CKvroxQ.png"></figure><h4 name="d709" id="d709" class="graf graf--h4 graf-after--figure"><strong class="markup--strong markup--h4-strong">Node.js CI/CD</strong></h4><p name="25e6" id="25e6" class="graf graf--p graf-after--h4">If you use an Angular application for frontend in 99% of cases your backend is Node.js (express, nest.js, etc.). It would be interesting to know if I am wrong (<em class="markup--em markup--p-em">write a comment on this article</em>).</p><p name="5f10" id="5f10" class="graf graf--p graf-after--p">The steps for setting Bitbucket SHH keys and adding hosts are the same so I don’t want to waste your time. I just provide you with an example of the “bitbucket-pipelines.yml” template:</p><figure name="bf36" id="bf36" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/TeslenkoOleg/ca7e212cace8b48f8c1d32f455689c71.js"></script></figure><p name="7cc7" id="7cc7" class="graf graf--p graf-after--figure graf--trailing">In this case, it is much easier, because we do not need to build an Angular application using Bitbucket cloud. We just connect to the remote host, change the branch, do any action (git pull, npm install, etc.), and restart the node.js application. I want to notice that you can add to your template option — <code class="markup--code markup--p-code">clone: enable: false</code> if don’t need to clone your project to Bitbucket cloud (<em class="markup--em markup--p-em">your pipeline would work faster</em>).</p></div></div></section><section name="ec26" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="3cea" id="3cea" class="graf graf--p graf--leading">In conclusion, I recommend at least trying to automate your deployment because it’s super convenient. You can keep your code and CI/CD pipelines all in one place, making collaboration and project management a breeze.</p><p name="18b4" id="18b4" class="graf graf--p graf-after--p">Another cool thing is that setting up your CI/CD pipelines becomes a piece of cake. You just write a simple configuration file using YAML, and you’re good to go. It takes care of all the repetitive tasks like building and testing, so you can focus more on coding and less on setup.</p><p name="50f4" id="50f4" class="graf graf--p graf-after--p graf--trailing">Thanks for your attention, if you like this article you can 👏 , follow me and write a comment.</p></div></div></section><section name="6583" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="28f9" id="28f9" class="graf graf--p graf--leading">Here are the other my articles:</p><div name="d133" id="d133" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://towardsdev.com/ram-in-node-memory-leak-5cfca356ddcc" data-href="https://towardsdev.com/ram-in-node-memory-leak-5cfca356ddcc" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://towardsdev.com/ram-in-node-memory-leak-5cfca356ddcc"><strong class="markup--strong markup--mixtapeEmbed-strong">Memory Leak in Node.js Apps</strong><br><em class="markup--em markup--mixtapeEmbed-em">This is my experience of detecting memory leaks in Node.js applications. I’m working on a project where the load on the…</em>towardsdev.com</a><a href="https://towardsdev.com/ram-in-node-memory-leak-5cfca356ddcc" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="bf8ff6f6e62fd39ade62f4b466cda884" data-thumbnail-img-id="1*-Nq1fQSPq9aeoWxn4WFbhg.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*-Nq1fQSPq9aeoWxn4WFbhg.jpeg);"></a></div><div name="343f" id="343f" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://towardsdev.com/bundle-analyzer-for-angular-app-8c3602a15922" data-href="https://towardsdev.com/bundle-analyzer-for-angular-app-8c3602a15922" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://towardsdev.com/bundle-analyzer-for-angular-app-8c3602a15922"><strong class="markup--strong markup--mixtapeEmbed-strong">Bundle analyzer for Angular app</strong><br><em class="markup--em markup--mixtapeEmbed-em">Sooner or later, when your application grows and becomes quite large, there is a need to optimize your code.</em>towardsdev.com</a><a href="https://towardsdev.com/bundle-analyzer-for-angular-app-8c3602a15922" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="7b91fcaa6cc5d3e116734a9b87208d7b" data-thumbnail-img-id="1*FrPAOIGTpQyIadsRgMV5BQ.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*FrPAOIGTpQyIadsRgMV5BQ.png);"></a></div><div name="b27e" id="b27e" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed graf--trailing"><a href="https://towardsdev.com/angular-mobile-app-by-cordova-c4864463c49" data-href="https://towardsdev.com/angular-mobile-app-by-cordova-c4864463c49" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://towardsdev.com/angular-mobile-app-by-cordova-c4864463c49"><strong class="markup--strong markup--mixtapeEmbed-strong">Mobile App using JavaScript / Angular</strong><br><em class="markup--em markup--mixtapeEmbed-em">How to create awesome mobile applications using Javascript? I have an answer — Cordova. A lot has already been written…</em>towardsdev.com</a><a href="https://towardsdev.com/angular-mobile-app-by-cordova-c4864463c49" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="5d63277dfcb9063baf7ce0e9050a5cf7" data-thumbnail-img-id="1*xQ3-LhV8GjoA9kJ7EOAbmg.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*xQ3-LhV8GjoA9kJ7EOAbmg.png);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@teslenkooleg2017" class="p-author h-card">Oleh Teslenko</a> on <a href="https://medium.com/p/9fa8680e4371"><time class="dt-published" datetime="2023-06-17T07:02:17.899Z">June 17, 2023</time></a>.</p><p><a href="https://medium.com/@teslenkooleg2017/automatic-application-deployment-using-bitbucket-pipelines-9fa8680e4371" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 8, 2024.</p></footer></article></body></html>